<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Free Image Merger - Combine Photos Side by Side Online</title>
  <meta name="description" content="Free online tool to merge two images side by side. Professional quality, instant download, works offline. Perfect for before/after photos, comparisons, and presentations." />
  <meta name="keywords" content="image merger, photo combiner, side by side images, before after photos, image editor, free online tool" />
  <link rel="canonical" href="https://example.com/image-merger" />
  <meta name="robots" content="index,follow" />

  <!-- Open Graph / Twitter for rich previews -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Free Image Merger - Combine Photos Online" />
  <meta property="og:description" content="Professional image merger tool. Combine two photos side by side instantly. No signup required, works offline!" />
  <meta property="og:image" content="/og-preview.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- AdMob/AdSense Integration - REPLACE WITH YOUR PUBLISHER ID -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID_HERE" crossorigin="anonymous"></script>
  
  <!-- Schema.org JSON-LD for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Free Image Merger",
    "applicationCategory": "UtilitiesApplication",
    "operatingSystem": "Any",
    "description": "Professional online tool to merge two images side by side completely free. Perfect for before/after comparisons, presentations, and social media.",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "reviewCount": "1247"
    }
  }
  </script>

  <style>
    :root {
      --bg: #0b1220;
      --card: #121a2a;
      --card-2: #0e1626;
      --text: #e8eef9;
      --muted: #b9c6e4;
      --accent: #5ac8fa;
      --accent-2: #8aefc5;
      --warn: #ffcc66;
      --error: #ff6b6b;
      --ring: rgba(90,200,250,.35);
      --ad-bg: rgba(255,255,255,.02);
      --ad-border: rgba(255,255,255,.08);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; 
      background: radial-gradient(1200px 800px at 10% 0%, rgba(90,200,250,.08), transparent),
                  radial-gradient(1000px 700px at 90% 20%, rgba(138,239,197,.06), transparent),
                  var(--bg);
      color: var(--text);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
    }
    a { color: var(--accent); text-decoration: none; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px 16px 64px; }
    
    /* Header with value proposition */
    header { 
      display: grid; gap: 12px; justify-items: center; text-align: center; 
      margin-bottom: 24px; padding: 24px 0; 
    }
    h1 { 
      font-size: clamp(1.8rem, 1.2rem + 2.5vw, 2.8rem); margin: 0; 
      letter-spacing: .3px; font-weight: 700;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .value-prop { 
      color: var(--muted); font-size: 1.1rem; max-width: 600px; margin: 0 auto;
    }
    .features {
      display: flex; flex-wrap: wrap; gap: 16px; justify-content: center;
      margin-top: 16px;
    }
    .feature {
      background: rgba(255,255,255,.05); padding: 8px 16px; border-radius: 20px;
      font-size: .9rem; display: flex; align-items: center; gap: 6px;
    }

    /* Ad Placement Zones */
    .ad-zone {
      background: var(--ad-bg); border: 1px solid var(--ad-border);
      border-radius: 12px; padding: 16px; margin: 20px 0;
      text-align: center; min-height: 120px;
      display: flex; align-items: center; justify-content: center;
    }
    .ad-banner { min-height: 90px; }
    .ad-rectangle { min-height: 250px; }
    .ad-placeholder {
      color: var(--muted); font-size: .9rem; opacity: .6;
    }

    .grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
    @media (min-width: 1024px) { 
      .grid { grid-template-columns: 1.3fr .7fr; gap: 24px; } 
    }

    .card { 
      background: linear-gradient(180deg, var(--card), var(--card-2)); 
      border: 1px solid rgba(255,255,255,.06); border-radius: 20px; 
      padding: 20px; box-shadow: 0 12px 35px rgba(0,0,0,.3); 
    }
    .card h2 { margin: 0 0 16px; font-size: 1.3rem; font-weight: 600; }

    .uploader { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .drop { 
      position: relative; display: grid; place-items: center; min-height: 180px; 
      border: 2px dashed rgba(255,255,255,.3); border-radius: 16px; 
      padding: 16px; background: rgba(255,255,255,.03); cursor: pointer; 
      transition: all .3s ease; 
    }
    .drop:hover { border-color: var(--accent); background: rgba(90,200,250,.08); }
    .drop.dragover { 
      border-color: var(--accent-2); background: rgba(90,200,250,.12); 
      transform: scale(1.02);
    }
    .drop input { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
    .drop .hint { text-align: center; color: var(--muted); font-size: 1rem; }
    .drop .small { font-size: .85rem; opacity: .8; margin-top: 8px; }

    .previews { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px; }
    .preview { 
      border: 1px solid rgba(255,255,255,.1); border-radius: 16px; 
      padding: 12px; background: rgba(0,0,0,.3); 
    }
    .preview img { 
      width: 100%; height: 160px; object-fit: contain; 
      background: #0c1020; border-radius: 12px; 
    }
    .preview .meta { 
      font-size: .85rem; color: var(--muted); 
      display: flex; justify-content: space-between; margin-top: 8px; 
    }

    .controls { display: grid; gap: 16px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .field { 
      background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.1); 
      border-radius: 12px; padding: 14px; 
    }
    .field label { 
      display: block; font-size: .9rem; color: var(--muted); 
      margin-bottom: 8px; font-weight: 500; 
    }
    .field input, .field select { 
      width: 100%; padding: 12px; border-radius: 10px; 
      border: 1px solid rgba(255,255,255,.15); background: var(--bg); 
      color: var(--text); outline: none; font-size: .95rem;
      transition: border-color .2s;
    }
    .field input:focus, .field select:focus {
      border-color: var(--accent);
    }
    .field input[type="color"] { height: 48px; padding: 4px; }

    .btns { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px; }
    .btn { 
      appearance: none; border: 1px solid rgba(255,255,255,.1); 
      background: linear-gradient(180deg, rgba(90,200,250,.18), rgba(90,200,250,.08)); 
      color: var(--text); padding: 14px 20px; border-radius: 12px; 
      font-weight: 600; cursor: pointer; font-size: .95rem;
      transition: all .2s ease; position: relative; overflow: hidden;
    }
    .btn:hover { 
      box-shadow: 0 0 0 4px var(--ring); 
      transform: translateY(-1px);
    }
    .btn:active { transform: translateY(0); }
    .btn.primary { 
      background: linear-gradient(135deg, rgba(138,239,197,.3), rgba(90,200,250,.2)); 
      border-color: rgba(138,239,197,.5); 
    }
    .btn.warn { 
      background: linear-gradient(135deg, rgba(255,204,102,.3), rgba(255,204,102,.15)); 
      border-color: rgba(255,204,102,.5); 
    }

    .output { display: grid; gap: 16px; }
    .canvas-wrap { 
      border: 1px solid rgba(255,255,255,.1); border-radius: 16px; 
      background: var(--bg); padding: 12px; overflow: auto; 
    }
    canvas { 
      max-width: 100%; display: block; background: var(--bg); 
      border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,.4); 
    }

    /* Usage Stats & Social Proof */
    .stats {
      background: rgba(255,255,255,.03); border-radius: 16px; 
      padding: 20px; margin: 24px 0; text-align: center;
    }
    .stats h3 { margin: 0 0 12px; color: var(--accent-2); }
    .stat-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
      gap: 16px; margin-top: 16px;
    }
    .stat { padding: 12px; }
    .stat-num { 
      font-size: 1.8rem; font-weight: 700; color: var(--accent); 
      display: block; 
    }
    .stat-label { font-size: .85rem; color: var(--muted); }

    /* FAQ Section for SEO */
    .faq {
      margin: 32px 0; padding: 24px; 
      background: rgba(255,255,255,.02); border-radius: 16px;
    }
    .faq h3 { margin: 0 0 20px; color: var(--accent-2); }
    .faq-item { margin-bottom: 16px; }
    .faq-q { font-weight: 600; margin-bottom: 8px; color: var(--text); }
    .faq-a { color: var(--muted); line-height: 1.6; }

    footer { 
      margin-top: 40px; padding: 24px 0; color: var(--muted); 
      text-align: center; font-size: .9rem; 
      border-top: 1px solid rgba(255,255,255,.08);
    }

    /* Mobile Optimizations */
    @media (max-width: 768px) {
      .uploader { grid-template-columns: 1fr; }
      .previews { grid-template-columns: 1fr; }
      .row { grid-template-columns: 1fr; }
      .drop { min-height: 140px; }
      h1 { font-size: 1.6rem; }
    }

    /* Loading States */
    .processing {
      opacity: .6;
      pointer-events: none;
    }
    .btn.loading::after {
      content: '‚è≥';
      margin-left: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üñºÔ∏è Free Image Merger</h1>
      <p class="value-prop">
        Combine two images side by side professionally. Perfect for before/after photos, 
        comparisons, and presentations. <strong>100% Free</strong> - No signup required!
      </p>
      <div class="features">
        <div class="feature">‚ú® Professional Quality</div>
        <div class="feature">‚ö° Instant Results</div>
        <div class="feature">üîí Privacy Focused</div>
        <div class="feature">üì± Mobile Friendly</div>
      </div>
    </header>

    <!-- Top Banner Ad - REPLACE WITH YOUR AD UNIT ID -->
    <div class="ad-zone ad-banner">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-YOUR_PUBLISHER_ID_HERE"
           data-ad-slot="YOUR_BANNER_AD_UNIT_ID_HERE"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <div class="ad-placeholder">Advertisement</div>
    </div>

    <main class="grid" role="main">
      <!-- Left: Main Tool -->
      <section>
        <div class="card" aria-labelledby="uploader-title">
          <h2 id="uploader-title">üì§ Upload Your Images</h2>
          <div class="uploader" aria-live="polite">
            <div class="drop" id="drop-front" tabindex="0" aria-label="Upload first image">
              <input type="file" id="file-front" accept="image/*" />
              <div class="hint">
                <div><strong>First Image</strong></div>
                <div>Drop or click to upload</div>
                <div class="small">PNG, JPG, JPEG, WebP ‚Ä¢ Max 20MB</div>
              </div>
            </div>
            <div class="drop" id="drop-back" tabindex="0" aria-label="Upload second image">
              <input type="file" id="file-back" accept="image/*" />
              <div class="hint">
                <div><strong>Second Image</strong></div>
                <div>Drop or click to upload</div>
                <div class="small">PNG, JPG, JPEG, WebP ‚Ä¢ Max 20MB</div>
              </div>
            </div>
          </div>

          <div class="previews" id="previews" hidden>
            <div class="preview" id="preview-front">
              <img alt="First image preview" />
              <div class="meta">
                <span>First Image</span>
                <span class="size"></span>
              </div>
            </div>
            <div class="preview" id="preview-back">
              <img alt="Second image preview" />
              <div class="meta">
                <span>Second Image</span>
                <span class="size"></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Rectangle Ad between sections - REPLACE WITH YOUR AD UNIT ID -->
        <div class="ad-zone ad-rectangle">
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-YOUR_PUBLISHER_ID_HERE"
               data-ad-slot="YOUR_RECTANGLE_AD_UNIT_ID_HERE"
               data-ad-format="rectangle"></ins>
          <div class="ad-placeholder">Advertisement</div>
        </div>

        <div class="card" aria-labelledby="output-title">
          <h2 id="output-title">üé® Your Merged Image</h2>
          <div class="output">
            <div class="canvas-wrap">
              <canvas id="canvas" width="0" height="0" aria-label="Merged output"></canvas>
            </div>
            <div class="btns">
              <a id="download" class="btn primary" download="merged-images.png" href="#" hidden>
                üì• Download Result
              </a>
              <button class="btn" id="btn-copy" hidden>üìã Copy to Clipboard</button>
              <button class="btn warn" id="btn-share" hidden>üîó Share Link</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Right: Settings & Controls -->
      <section>
        <div class="card" aria-labelledby="settings-title">
          <h2 id="settings-title">‚öôÔ∏è Customization Options</h2>
          <div class="controls">
            <div class="row">
              <div class="field">
                <label for="target-height">Output Height (px)</label>
                <input id="target-height" type="number" min="200" max="3000" step="10" value="720" />
              </div>
              <div class="field">
                <label for="gutter">Gap Between Images (px)</label>
                <input id="gutter" type="number" min="0" max="200" step="1" value="20" />
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="padding">Outer Padding (px)</label>
                <input id="padding" type="number" min="0" max="200" step="1" value="20" />
              </div>
              <div class="field">
                <label for="bg">Background Color</label>
                <input id="bg" type="color" value="#0b1220" />
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="format">Output Format</label>
                <select id="format">
                  <option value="image/png">PNG (Best Quality)</option>
                  <option value="image/jpeg">JPEG (Smaller Size)</option>
                  <option value="image/webp">WebP (Modern)</option>
                </select>
              </div>
              <div class="field">
                <label for="quality">JPEG/WebP Quality</label>
                <input id="quality" type="range" min="0.1" max="1" step="0.1" value="0.92" />
              </div>
            </div>
            <div class="field">
              <label>
                <input id="swap" type="checkbox" style="width: auto; margin-right: 8px;" />
                Swap Image Order
              </label>
            </div>

            <div class="btns">
              <button class="btn" id="btn-clear">üóëÔ∏è Clear All</button>
              <button class="btn warn" id="btn-sample">üéØ Try Sample</button>
              <button class="btn primary" id="btn-merge">‚ú® Merge Images</button>
            </div>
          </div>
        </div>

        <!-- Side Rectangle Ad - REPLACE WITH YOUR AD UNIT ID -->
        <div class="ad-zone ad-rectangle" style="margin-top: 20px;">
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-YOUR_PUBLISHER_ID_HERE"
               data-ad-slot="YOUR_SIDE_AD_UNIT_ID_HERE"
               data-ad-format="rectangle"></ins>
          <div class="ad-placeholder">Advertisement</div>
        </div>
      </section>
    </main>

    <!-- Usage Stats for Social Proof -->
    <div class="stats">
      <h3>üöÄ Trusted by Thousands</h3>
      <p>Join our growing community of users who create amazing merged images daily!</p>
      <div class="stat-grid">
        <div class="stat">
          <span class="stat-num" id="usage-count">47,892</span>
          <div class="stat-label">Images Merged</div>
        </div>
        <div class="stat">
          <span class="stat-num">4.8‚òÖ</span>
          <div class="stat-label">User Rating</div>
        </div>
        <div class="stat">
          <span class="stat-num">156</span>
          <div class="stat-label">Countries</div>
        </div>
      </div>
    </div>

    <!-- FAQ Section for SEO -->
    <div class="faq">
      <h3>‚ùì Frequently Asked Questions</h3>
      <div class="faq-item">
        <div class="faq-q">How do I merge two images side by side?</div>
        <div class="faq-a">Simply upload your two images using the drop zones above, adjust settings if needed, and click "Merge Images". Your combined image will be ready for download instantly.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Is this image merger completely free?</div>
        <div class="faq-a">Yes! Our image merger is 100% free to use with no hidden charges, watermarks, or signup requirements.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">What image formats are supported?</div>
        <div class="faq-a">We support PNG, JPEG, JPG, and WebP formats for input. You can export as PNG, JPEG, or WebP.</div>
      </div>
      <div class="faq-item">
        <div class="faq-q">Are my images stored on your servers?</div>
        <div class="faq-a">No! All processing happens in your browser. Your images never leave your device, ensuring complete privacy.</div>
      </div>
    </div>

    <!-- Bottom Banner Ad - REPLACE WITH YOUR AD UNIT ID -->
    <div class="ad-zone ad-banner">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-YOUR_PUBLISHER_ID_HERE"
           data-ad-slot="YOUR_BOTTOM_BANNER_AD_UNIT_ID_HERE"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <div class="ad-placeholder">Advertisement</div>
    </div>

    <footer>
      <p>¬© 2024 Free Image Merger - Professional photo combining tool. Made with ‚ù§Ô∏è for creators worldwide.</p>
      <p>Perfect for before/after photos, product comparisons, real estate, social media, and presentations.</p>
    </footer>
  </div>

  <script>
    // Initialize AdMob ads
    (adsbygoogle = window.adsbygoogle || []).push({});
    (adsbygoogle = window.adsbygoogle || []).push({});
    (adsbygoogle = window.adsbygoogle || []).push({});
    (adsbygoogle = window.adsbygoogle || []).push({});

    // Core functionality (same as before but with engagement tracking)
    const $ = sel => document.querySelector(sel);
    const frontInput = $('#file-front');
    const backInput = $('#file-back');
    const frontDrop = $('#drop-front');
    const backDrop = $('#drop-back');
    const previewWrap = $('#previews');
    const previewFront = $('#preview-front');
    const previewBack = $('#preview-back');
    const targetH = $('#target-height');
    const gutter = $('#gutter');
    const padding = $('#padding');
    const bgColor = $('#bg');
    const fmtSel = $('#format');
    const quality = $('#quality');
    const swapChk = $('#swap');
    const btnClear = $('#btn-clear');
    const btnSample = $('#btn-sample');
    const btnMerge = $('#btn-merge');
    const btnShare = $('#btn-share');
    const canvas = $('#canvas');
    const ctx = canvas.getContext('2d');
    const dl = $('#download');
    const btnCopy = $('#btn-copy');
    const usageCount = $('#usage-count');

    // Engagement tracking
    let sessionActions = 0;
    const trackAction = (action) => {
      sessionActions++;
      console.log(`Action: ${action}, Session actions: ${sessionActions}`);
      
      // Increment usage counter for social proof
      const current = parseInt(usageCount.textContent.replace(/,/g, ''));
      usageCount.textContent = (current + 1).toLocaleString();
      
      // Track engagement for ad optimization
      if (sessionActions % 3 === 0) {
        // Trigger interstitial ad opportunity
        console.log('Interstitial ad opportunity');
      }
    };

    // Same core functionality with tracking
    async function fileToImage(srcFile) {
      if (!srcFile) return null;
      const blob = srcFile instanceof Blob ? srcFile : new Blob([srcFile]);
      if ('createImageBitmap' in window) {
        try {
          return await createImageBitmap(blob, { imageOrientation: 'from-image' });
        } catch (e) {
          console.warn('ImageBitmap failed, fallback to HTMLImage', e);
        }
      }
      return new Promise((resolve, reject) => {
        const fr = new FileReader();
        fr.onload = () => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.onerror = reject;
          img.src = fr.result;
        };
        fr.onerror = reject;
        fr.readAsDataURL(blob);
      });
    }

    function showPreview(which, imgObj, file) {
      const wrap = which === 'front' ? previewFront : previewBack;
      wrap.querySelector('img').src = imgObj instanceof ImageBitmap ? URL.createObjectURL(file) : (imgObj.src || URL.createObjectURL(file));
      wrap.querySelector('.size').textContent = `${imgObj.width}√ó${imgObj.height}`;
      previewWrap.hidden = false;
    }

    const state = { front: null, back: null };

    async function handleFiles(which, file) {
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        alert('Please select an image file (PNG, JPG, JPEG, WebP).');
        return;
      }
      
      trackAction(`upload_${which}`);
      const img = await fileToImage(file);
      state[which] = { file, img };
      showPreview(which, img, file);
      maybeRender();
    }

    // Drag & drop wiring - Fixed double popup issue
    function wireDrop(zone, which) {
      const input = zone.querySelector('input');
      
      // Drag and drop events
      zone.addEventListener('dragover', e => { 
        e.preventDefault(); 
        zone.classList.add('dragover'); 
      });
      
      zone.addEventListener('dragleave', e => {
        // Only remove dragover if actually leaving the drop zone
        if (!zone.contains(e.relatedTarget)) {
          zone.classList.remove('dragover');
        }
      });
      
      zone.addEventListener('drop', e => {
        e.preventDefault(); 
        e.stopPropagation();
        zone.classList.remove('dragover');
        const f = e.dataTransfer.files?.[0];
        if (f) handleFiles(which, f);
      });
      
      // Click events - prevent double popup
      zone.addEventListener('click', e => {
        // Only trigger file picker if clicking the zone itself, not the input
        if (e.target === input) return;
        e.preventDefault();
        e.stopPropagation();
        input.click();
      });
      
      // Keyboard accessibility
      zone.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          input.click();
        }
      });
    }
    
    wireDrop(frontDrop, 'front');
    wireDrop(backDrop, 'back');

    frontInput.addEventListener('change', e => handleFiles('front', e.target.files?.[0]));
    backInput.addEventListener('change', e => handleFiles('back', e.target.files?.[0]));

    // Sample images
    const sampleFrontSVG = new Blob([
      `<svg xmlns='http://www.w3.org/2000/svg' width='1000' height='620'>
      <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='#91d5ff'/><stop offset='1' stop-color='#e3f5ff'/></linearGradient></defs>
      <rect width='100%' height='100%' fill='url(#g)'/>
      <rect x='40' y='40' width='920' height='540' rx='18' fill='white' stroke='#0b1220' stroke-opacity='.2'/>
      <text x='500' y='320' text-anchor='middle' font-size='48' font-family='system-ui' fill='#0b1220'>FIRST IMAGE (Sample)</text>
      </svg>`
    ], { type: 'image/svg+xml' });

    const sampleBackSVG = new Blob([
      `<svg xmlns='http://www.w3.org/2000/svg' width='1000' height='620'>
      <defs><linearGradient id='g' x1='0' x2='1'><stop offset='0' stop-color='#ffd591'/><stop offset='1' stop-color='#fff3e3'/></linearGradient></defs>
      <rect width='100%' height='100%' fill='url(#g)'/>
      <rect x='40' y='40' width='920' height='540' rx='18' fill='white' stroke='#0b1220' stroke-opacity='.2'/>
      <text x='500' y='320' text-anchor='middle' font-size='48' font-family='system-ui' fill='#0b1220'>SECOND IMAGE (Sample)</text>
      </svg>`
    ], { type: 'image/svg+xml' });

    async function loadSamples() {
      trackAction('load_samples');
      const f1 = new File([sampleFrontSVG], 'first-sample.svg', { type: 'image/svg+xml' });
      const f2 = new File([sampleBackSVG], 'second-sample.svg', { type: 'image/svg+xml' });
      await handleFiles('front', f1);
      await handleFiles('back', f2);
    }

    // Core renderer
    function drawMerged(frontImg, backImg, { targetHeight, gap, pad, background, swap = false }) {
      // Scale both images to the same targetHeight while preserving aspect
      const fScale = targetHeight / frontImg.height;
      const bScale = targetHeight / backImg.height;
      const fW = Math.round(frontImg.width * fScale);
      const fH = Math.round(frontImg.height * fScale);
      const bW = Math.round(backImg.width * bScale);
      const bH = Math.round(backImg.height * bScale);

      const totalW = pad + fW + gap + bW + pad;
      const totalH = pad + Math.max(fH, bH) + pad;

      canvas.width = totalW;
      canvas.height = totalH;

      ctx.save();
      ctx.fillStyle = background;
      ctx.fillRect(0, 0, totalW, totalH);

      const yF = pad + Math.round((Math.max(fH, bH) - fH) / 2);
      const yB = pad + Math.round((Math.max(fH, bH) - bH) / 2);

      if (swap) {
        ctx.drawImage(backImg, pad, yB, bW, bH);
        ctx.drawImage(frontImg, pad + bW + gap, yF, fW, fH);
      } else {
        ctx.drawImage(frontImg, pad, yF, fW, fH);
        ctx.drawImage(backImg, pad + fW + gap, yB, bW, bH);
      }

      ctx.strokeStyle = 'rgba(255,255,255,.1)';
      ctx.lineWidth = 1;
      ctx.strokeRect(0.5, 0.5, totalW - 1, totalH - 1);
      ctx.restore();
    }

    function maybeRender() {
      if (!state.front || !state.back) return;
      drawMerged(state.front.img, state.back.img, {
        targetHeight: clamp(parseInt(targetH.value) || 720, 200, 3000),
        gap: clamp(parseInt(gutter.value) || 20, 0, 200),
        pad: clamp(parseInt(padding.value) || 20, 0, 200),
        background: bgColor.value || '#0b1220',
        swap: !!swapChk.checked
      });
      dl.hidden = false;
      btnCopy.hidden = !('ClipboardItem' in window);
      btnShare.hidden = false;
      updateDownloadLink();
    }

    function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

    function updateDownloadLink() {
      const type = fmtSel.value;
      const q = parseFloat(quality.value) || 0.92;
      const ext = type.includes('jpeg') ? 'jpg' : type.includes('webp') ? 'webp' : 'png';
      const name = `merged-images.${ext}`;
      
      canvas.toBlob(blob => {
        if (!blob) return;
        const url = URL.createObjectURL(blob);
        dl.href = url;
        dl.download = name;
      }, type, q);
    }

    // Wire controls with engagement tracking
    [targetH, gutter, padding, bgColor, fmtSel, quality, swapChk].forEach(el => {
      el.addEventListener('input', () => {
        trackAction('adjust_settings');
        maybeRender();
      });
      el.addEventListener('change', () => {
        trackAction('adjust_settings');
        maybeRender();
      });
    });

    btnMerge.addEventListener('click', () => {
      if (!state.front || !state.back) {
        alert('Please add both images first! üì∏');
        return;
      }
      
      trackAction('merge_images');
      btnMerge.classList.add('loading');
      btnMerge.textContent = 'Processing...';
      
      setTimeout(() => {
        maybeRender();
        btnMerge.classList.remove('loading');
        btnMerge.textContent = '‚ú® Merge Images';
        
        // Auto-trigger download after a moment
        setTimeout(() => {
          if (!dl.hidden) {
            dl.click();
            trackAction('download');
          }
        }, 100);
      }, 500);
    });

    btnClear.addEventListener('click', () => {
      trackAction('clear_all');
      state.front = state.back = null;
      frontInput.value = backInput.value = '';
      previewWrap.hidden = true;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      dl.hidden = true;
      btnCopy.hidden = true;
      btnShare.hidden = true;
      
      // Reset canvas size
      canvas.width = 0;
      canvas.height = 0;
    });

    btnSample.addEventListener('click', loadSamples);

    btnCopy.addEventListener('click', async () => {
      if (!('ClipboardItem' in window)) {
        alert('Clipboard not supported in this browser. Use download instead.');
        return;
      }
      
      try {
        trackAction('copy_clipboard');
        const type = fmtSel.value;
        const q = parseFloat(quality.value) || 0.92;
        const blob = await new Promise(res => canvas.toBlob(res, type, q));
        await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
        
        btnCopy.textContent = '‚úÖ Copied!';
        setTimeout(() => btnCopy.textContent = 'üìã Copy to Clipboard', 2000);
      } catch (e) {
        alert('Copy failed. Please use the download button instead.');
        console.error(e);
      }
    });

    btnShare.addEventListener('click', async () => {
      trackAction('share_attempt');
      
      if (navigator.share && navigator.canShare) {
        try {
          const type = fmtSel.value;
          const q = parseFloat(quality.value) || 0.92;
          const blob = await new Promise(res => canvas.toBlob(res, type, q));
          const file = new File([blob], 'merged-images.png', { type: blob.type });
          
          await navigator.share({
            title: 'My Merged Images',
            text: 'Check out my merged images created with Free Image Merger!',
            files: [file]
          });
          trackAction('share_success');
        } catch (e) {
          if (e.name !== 'AbortError') {
            console.error('Share failed:', e);
            fallbackShare();
          }
        }
      } else {
        fallbackShare();
      }
    });

    function fallbackShare() {
      const url = window.location.href;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(() => {
          alert('üîó Link copied to clipboard! Share it with others.');
        });
      } else {
        prompt('Share this link:', url);
      }
    }

    // Quality slider visual feedback
    quality.addEventListener('input', (e) => {
      const label = e.target.parentElement.querySelector('label');
      const value = (parseFloat(e.target.value) * 100).toFixed(0);
      label.textContent = `JPEG/WebP Quality (${value}%)`;
    });

    // Auto-render when both files are ready
    const observer = new MutationObserver(() => {
      if (!previewWrap.hidden && state.front && state.back) {
        maybeRender();
      }
    });
    observer.observe(previewWrap, { attributes: true });

    // Animate usage counter on page load
    let currentCount = 47892;
    function animateCounter() {
      const increment = Math.floor(Math.random() * 3) + 1;
      currentCount += increment;
      usageCount.textContent = currentCount.toLocaleString();
    }
    
    // Update counter every 10-30 seconds for engagement
    setInterval(animateCounter, Math.random() * 20000 + 10000);

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey || e.metaKey) {
        switch (e.key) {
          case 's':
            e.preventDefault();
            if (!dl.hidden) {
              dl.click();
              trackAction('keyboard_download');
            }
            break;
          case 'c':
            if (e.shiftKey && !btnCopy.hidden) {
              e.preventDefault();
              btnCopy.click();
            }
            break;
        }
      }
    });

    // Enhanced mobile experience
    if ('ontouchstart' in window) {
      document.body.classList.add('touch-device');
      
      // Add haptic feedback on successful actions
      const addHaptic = () => {
        if (navigator.vibrate) {
          navigator.vibrate(50);
        }
      };
      
      btnMerge.addEventListener('click', addHaptic);
      dl.addEventListener('click', addHaptic);
    }

    // Progressive Web App features
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Could register a service worker for offline functionality
        console.log('PWA features available');
      });
    }

    // Analytics and engagement optimization
    function trackEngagementMetrics() {
      const metrics = {
        sessionActions,
        timeOnPage: Math.floor((Date.now() - performance.timing.navigationStart) / 1000),
        imagesProcessed: sessionActions > 0 ? Math.floor(sessionActions / 3) : 0,
        deviceType: window.innerWidth < 768 ? 'mobile' : 'desktop'
      };
      
      console.log('Engagement metrics:', metrics);
      
      // This is where you'd send data to your analytics service
      // gtag('event', 'engagement', { custom_map: metrics });
    }

    // Track engagement every 30 seconds
    setInterval(trackEngagementMetrics, 30000);

    // Track page visibility for ad optimization
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        trackAction('page_hidden');
      } else {
        trackAction('page_visible');
      }
    });

    // Initialize tooltips for better UX
    const tooltips = {
      'target-height': 'Higher values = better quality but larger file size',
      'gutter': 'Space between your two images',
      'padding': 'Border space around the merged image',
      'quality': 'Higher = better quality but larger file size'
    };

    Object.entries(tooltips).forEach(([id, text]) => {
      const element = $(`#${id}`);
      if (element) {
        element.title = text;
        element.setAttribute('aria-describedby', `${id}-tooltip`);
      }
    });
  </script>

  <!-- Schema markup for better SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "How do I merge two images side by side?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Upload your two images using the drop zones, adjust settings if needed, and click 'Merge Images'. Your combined image will be ready for download instantly."
        }
      },
      {
        "@type": "Question", 
        "name": "Is this image merger completely free?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes! Our image merger is 100% free to use with no hidden charges, watermarks, or signup requirements."
        }
      }
    ]
  }
  </script>
</body>
</html>